import os
import pandas as pd
import re

# Path to the folder containing Excel files
folder_path = "/path/to/your/folder"

# Read the replacement data from "replace.xlsx"
replace_df = pd.read_excel("replace.xlsx")

# Create a log file to record replacements
log_file = open("replacements_log.txt", "w")

# Iterate through all Excel files in the folder
for filename in os.listdir(folder_path):
    if filename.endswith(".xlsx"):
        file_path = os.path.join(folder_path, filename)
        df = pd.read_excel(file_path)

        # Initialize a counter for replacements
        replacements_count = 0

        # Perform find-and-replace within sentences
        for index, row in replace_df.iterrows():
            find_word = row.iloc[0]  # First column
            replace_word = row.iloc[1]  # Second column

            # Iterate through each cell in the DataFrame
            for col in df.columns:
                df[col] = df[col].apply(lambda cell: re.sub(r'\b' + find_word + r'\b', replace_word, str(cell)) if pd.notna(cell) else cell)

            # Update the replacements count
            replacements_count += df.apply(lambda col: col.str.count(replace_word).sum()).sum()

        # Save the modified DataFrame back to the same file
        df.to_excel(file_path, index=False)

        # Log the replacements
        log_file.write(f"File: {filename}, Replacements: {replacements_count}\n")

log_file.close()
print("Find-and-replace completed for all Excel files in the folder. Log saved in 'replacements_log.txt'.")
